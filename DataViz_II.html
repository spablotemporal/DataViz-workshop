<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Pablo Gomez" />

<meta name="date" content="2023-06-09" />

<title>Further customization</title>

<script src="site_libs/header-attrs-2.21/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.0/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Idioma
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://www.spablo-temporal.network/DataViz-workshop/">English</a>
    </li>
    <li>
      <a href="ES/index.html">Español</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Contact
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="mailto:jpgo@ucdavis.edu">
        <span class="fa fa-envelope"></span>
         
        Email
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Further customization</h1>
<h4 class="author">Pablo Gomez</h4>
<h4 class="date">2023-06-09</h4>

</div>


<p>This lab continues on the work previously done for the <a
href="DataViz_I.html">Section I</a>, make sure you have the objects
generated in the previous section.</p>
<div id="themes" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Themes</h1>
<p>ggplot includes the function <code>theme()</code> to define most of
the aspects of the figure such as the background color, the grid, axes,
legend, among many others. There is also several predefined themes (all
start with <code>theme_</code> followed by the name of the theme) that
you can use, if don’t want to mess with all the arguments from the
function <code>theme()</code>. For example:</p>
<pre class="r"><code># all the predefined themes start with theme_
figures$heatmap &lt;- figures$heatmap +
  theme_classic2() + # We will use the theme minimal
  coord_equal() # we will set the coordinates to equal to improve the aspect ratio

figures$heatmap</code></pre>
<p><img src="DataViz_II_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
</div>
<div id="other-aesthetics" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Other aesthetics</h1>
<div id="shape" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Shape</h2>
<p>There are other aesthetics we can define such as color, type of
point, size, among many others. Lets try changing the point shape for
one of the plots we previously did:</p>
<pre class="r"><code>figures$scatter &lt;- captures %&gt;% # the data we are using
  ggplot() + # we set the canvas
  geom_point(aes(
    x = captures, # X axis
    y = treated, # Y axis
    shape = factor(trap_type) # point shape
  )) +
  theme_classic() # now lets try the theme &#39;classic&#39;

figures$scatter</code></pre>
<p><img src="DataViz_II_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="color" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Color</h2>
<pre class="r"><code>tCaptures &lt;- captures %&gt;% 
  mutate(date = as.Date(date, &quot;%d/%m/%y&quot;), # First we will format the date
         year = lubridate::floor_date(date, &#39;year&#39;)) %&gt;%  # The we create a variable formatting the date as month of the year
  count(year, trap_type) # Count the number of observations by month

figures$timeseries &lt;- tCaptures %&gt;% 
  ggplot() +
  geom_line(aes(x = year, y = n, col = factor(trap_type))) +
  theme_minimal()

figures$timeseries</code></pre>
<p><img src="DataViz_II_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
</div>
<div id="non-aesthetics-customization" class="section level1"
number="3">
<h1><span class="header-section-number">3</span> Non aesthetics
customization</h1>
<p>So far we have added variables inside our <code>aes()</code>
function, but we can add some arguments outside the <code>aes()</code>
function that we want them to be applied for ALL observations. For
example, we can change the size and transparency of the points in our
scatter plot, which can be useful to see where there is more overlap of
observations:</p>
<pre class="r"><code>figures$scatter &lt;- captures %&gt;% # the data we are using
  ggplot() + # we set the canvas
  geom_point(
    aes(x = captures, y = treated, shape = factor(trap_type)), # aesthetics
    size = 2.5,
    alpha = 0.2 # alpha will define the transparency of the points
  )

figures$scatter</code></pre>
<p><img src="DataViz_II_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>You can change other components of the figure such as the color,
shape, size, etc.. Remember that everything that goes inside the
<code>aes()</code> function will be dependent on the variables from the
data and whatever goes outside are constants for all the
observations.</p>
</div>
<div id="scales" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Scales</h1>
<p>As you noticed by default R pick specific colors and shapes for the
variables we use to map our figure, scales in <code>ggplot2</code> is a
way to specify the shapes, colors or sizes used for the figures. There
is a family of functions (<code>scales_*</code>) where <code>*</code>
represents the aesthetic we want to define. Depending on the type of
variable you want to set the scale for, you will select the
corresponding function.</p>
<div id="continuous-values" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Continuous
values</h2>
<p>For example, if we want to change the colors for the fill on a
continuous variable we can define the colors for a gradient with the
function <code>scale_fill_gradient()</code>.</p>
<pre class="r"><code>figures$heatmap &lt;- figures$heatmap + # Lets us our previously defined heatmap
  scale_fill_gradient(low = &#39;black&#39;, high = &#39;red&#39;) # we use the function to set the colors

figures$heatmap</code></pre>
<p><img src="DataViz_II_files/figure-html/gradient%20scales-1.png" width="672" /></p>
</div>
<div id="categorical-values" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Categorical
values</h2>
<p>When using categorical variables we define a specific color palette.
For this we need to know how many categories our variable has. For
example</p>
<pre class="r"><code># Define a oclor palette
colpal &lt;- c(&#39;gold2&#39;, &#39;seagreen3&#39;, &#39;red2&#39;, &#39;orchid&#39;)

# Make the figure
figures$bars &lt;- figures$bars +
  scale_fill_manual(values = colpal) # We know our variable has 4 categories, so we define 4 colors

figures$bars</code></pre>
<p><img src="DataViz_II_files/figure-html/categorical%20scales-1.png" width="672" /></p>
</div>
<div id="how-to-find-colors" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> How to find
colors?</h2>
<p>R manages colors in three different ways: by name (i.e: ‘red’), by
rgb value using the function <code>rgb()</code>
(i.e. <code>rgb(1, 0, 0)</code>), or using <a
href="https://marketing.istockphoto.com/blog/hex-colors-guide/">hexadecimal
code</a> (i.e. “#F00000”). You can get a full list of the named colors
in R by using the function <code>colors()</code>, but you will only be
able to see the names. Luckly someone made a tool that can help us
exacly the colors that we want: the <em>Colour Picker</em> addin. Addins
are tools that are available in Rstudio to facilitate tasks, lets try
the <em>colour picker</em> (should be already in your addins
toolbar).</p>
<p><img src="img/I_colPicker.gif" /></p>
<p>Other resources to find colors include:</p>
<ul>
<li><a
href="https://coolors.co/334139-1e2d24-c52184-e574bc-f9b4ed">Coolors
palette generator</a>: This website generates random color palettes and
includes other user generated palettes</li>
<li><a href="https://colourcontrast.cc">Colour contrast checker</a>:
This website has a tool to check the contrast between two colors, can be
useful when setting labels and other annotations in our figures.</li>
</ul>
</div>
</div>
<div id="labels" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Labels</h1>
<p>Usually we try to avoid spaces when using names for the column names,
but for our figure labels this could be not the most straight forward
way to communicate our analysis, we can set specific labels to make our
plots more readable and self explanatory. Let’s improve bar plot figure
a bit more to make it clearer, we can use the figure we previously
created contained in our figures list <code>figures$bars</code></p>
<pre class="r"><code>figures$bars &lt;- figures$bars + # we call the figure previously created
  labs(# We will use the function labs to generate our labels
    title = &#39;Number of observations by Municipality&#39;, # The title we will give to our figure
    x = &#39;Number of observations&#39;, # The label for x axis
    y = &#39;Municipality&#39;, # label for y axis
    fill = &#39;Trap type&#39;
  )

figures$bars</code></pre>
<p><img src="DataViz_II_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div id="in-figure-labels" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> In figure labels</h2>
<pre class="r"><code>library(ggrepel)

lab &lt;- tCaptures %&gt;% 
  group_by(trap_type) %&gt;% 
  filter(year == min(year))

figures$timeseries +
  geom_label_repel(data = lab, aes(x = year, y = n, label = paste(&#39;Trap \n type: &#39;, trap_type), fill = factor(trap_type)), alpha = 0.6, size = 3) +
  scale_color_manual(values = colpal)</code></pre>
<p><img src="DataViz_II_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
</div>
<div id="beyond-basic-themes" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Beyond basic
themes</h1>
<p>Lets pretend that we want to flip the axis from our bar plot because
we think will fit better our report, we can do that from the
<code>aes()</code> function by redefining the axes, but in this case I
will just use the function <code>coord_flip()</code> to do the same.</p>
<pre class="r"><code>figures$bars &lt;- figures$bars + # we call the figure previously created
  coord_flip() # We use this function to flip the x and y axis.

figures$bars</code></pre>
<p><img src="DataViz_II_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Like you will notice, there is some overlap between the
municipalities text and we can barely read them. We can modify the
position of the x labels to fix this, to do this we need to modify the
theme.</p>
<div id="labels-1" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Labels</h2>
<p>The <code>theme()</code> function has a bunch of arguments which you
can see in detail in the documentation (or using the auto complete
functionality in RStudio/posit.cloud), the argument we will need to
define is <code>axis.text.x</code>, the argument takes a specific type
of object used to format the text, to create this object we use the
function <code>element_text()</code>. It will make more sense when we
try it:</p>
<pre class="r"><code>figures$bars &lt;- figures$bars + # we call the figure previously created
  coord_flip() + # We use this function to flip the x and y axis.
  theme(axis.text.x = element_text(angle = 40, size = 7))

figures$bars</code></pre>
<p><img src="DataViz_II_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="grid" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Grid</h2>
<p>Other things we can change in the <code>theme()</code> function
includes the background of the figure, lets make some changes to the
grid and the background color.</p>
<pre class="r"><code>figures$bars &lt;- figures$bars +
  theme(
    panel.grid = element_line(color = &#39;grey80&#39;), # Change the color of the grid
    panel.grid.major.x = element_blank(),# Remove the grid for the x axis
    panel.background = element_rect(fill = &#39;mintcream&#39;) # Change the background of the figure
  )

figures$bars</code></pre>
<p><img src="DataViz_II_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>If you noticed, when defining the arguments, I used different
functions for the elements used (i.e. <code>element_blank()</code>,
<code>element_rect()</code>, <code>element_line()</code>). Depending on
the theme element you will need to define the appropiate element to use,
in brief:</p>
<ul>
<li><code>element_blank()</code> is for empty elements (i.e. when you
want to remove it)</li>
<li><code>element_rect()</code> is for filled geometries (i.e. the
background of the panel or legend)</li>
<li><code>element_line()</code> for lines such as the grid</li>
<li><code>element_text()</code> for text elements such as the
labels</li>
</ul>
</div>
</div>
<div id="exercise" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Exercise:</h1>
<p>Now spend some time using the resources we talked about to modify the
figure and be creative with the colors and the theme, maybe use the
color scale of your favorite sports team, character of a movie, or
something you like. Feel free to modify any of the figures that we
previously created!</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
