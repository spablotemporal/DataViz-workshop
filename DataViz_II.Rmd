---
title: "Further customization"
author: "Pablo Gomez"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = F, message = F)
library(dplyr); library(ggplot2); library(ggpubr);library(Pabloverse); library(STNet)
```

```{r import prev objects, include = F}
load('misc/I/captures.RData')
load('misc/I/figures.RData')
load('misc/I/tCaptures.RData')
```

# Further customization

## Themes

ggplot includes the function `theme()` to define most of the aspects of the figure such as the background color, the grid, axes, legend, among many others. There is also several predefined themes (all start with `theme_` followed by the name of the theme) that you can use, if don't want to mess with all the arguments from the function `theme()`. For example:

```{r}
# all the predefined themes start with theme_
figures$heatmap <- figures$heatmap +
  theme_classic2() + # We will use the theme minimal
  coord_equal() # we will set the coordinates to equal to improve the aspect ratio

figures$heatmap
```

## Other aesthetics

### Shape

There are other aesthetics we can define such as color, type of point, size, among many others. Lets try changing the point shape for one of the plots we previously did:

```{r}
figures$scatter <- captures %>% # the data we are using
  ggplot() + # we set the canvas
  geom_point(aes(
    x = captures, # X axis
    y = treated, # Y axis
    shape = factor(trap_type) # point shape
  )) +
  theme_classic() # now lets try the theme 'classic'

figures$scatter
```

### Color

We can add extra variables to indicate the composition (using another variable) of each of the levels in our figures. For example, we will add the variable *trap_type* to color the bars in this figure. to do this we add the argument `fill=factor(trap_type)` to our `aes()` function

```{r}
figures$bars <- captures %>% 
  count(municipality, trap_type) %>% 
  ggplot() +
  geom_bar(aes(
    y = municipality, # X axis
    x = n, # Y axis
    fill = factor(trap_type) # Variable used for fill
  ), stat = 'identity') # type of bar plot

figures$bars
```

There are different strategies to visualize this, another example would be to breakdown the composition in individual bars like in the following figure, this can be useful to compare the within group composition:

```{r}
captures %>% 
  count(municipality, trap_type) %>% 
  ggplot() +
  geom_bar(aes(
    y = municipality, # X axis
    x = n, # Y axis
    fill = factor(trap_type)
  ), stat = 'identity', position = 'dodge') # type of barplot
```


Another option is looking the composition as a proportion by adding the argument `position = 'fill` to the `geom_bar()` function, notice that this removes the sense of number of observations for the main category (*year*):

```{r}
captures %>% 
  count(municipality, trap_type) %>% 
  ggplot() +
  geom_bar(aes(
    y = municipality, # X axis
    x = n, # Y axis
    fill = factor(trap_type)
  ), stat = 'identity',
  position = 'fill') # type of bar plot
```

### Non aesthetics customization

So far we have added variables inside our `aes()` function, but we can add some arguments outside the `aes()` function that we want them to be applied for ALL observations. For example, we can change the size and transparency of the points in our scatter plot, which can be useful to see where there is more overlap of observations:

```{r}
figures$scatter <- captures %>% # the data we are using
  ggplot() + # we set the canvas
  geom_point(
    aes(x = captures, y = treated, shape = factor(trap_type)), # aesthetics
    size = 2.5,
    alpha = 0.2 # alpha will define the transparency of the points
  )

figures$scatter
```

You can change other components of the figure such as the color, shape, size, etc.. Remember that everything that goes inside the `aes()` function will be dependent on the variables from the data and whatever goes outside are constants for all the observations.   

# Scales

## Continuous values

```{r gradient scales}
figures$heatmap <- figures$heatmap +
  scale_fill_gradient(low = 'black', high = 'red')

figures$heatmap
```

## Categorical values

As you noticed by default R pick specific colors and shapes for the variables we use to map our figure, scales in `ggplot2` is a way to specify the shapes, colors or sizes used for the figures. There is a family of functions (`scales_*`) where `*` represents the aesthetic we want to define. For example, if we want to change the colors for the fill, we can use:

```{r categorical scales}
figures$bars <- figures$bars +
  scale_fill_manual(values = c('gold2', 'seagreen3', 'red2', 'orchid'))

figures$bars
```


## How to find colors?

R manages colors in three different ways: by name (i.e: 'red'), by rgb value using the function `rgb()` (i.e. `rgb(1, 0, 0)`), or using [hexadecimal code](https://marketing.istockphoto.com/blog/hex-colors-guide/) (i.e. "#F00000"). You can get a full list of the named colors in R by using the function `colors()`, but you will only be able to see the names. Luckly someone made a tool that can help us exacly the colors that we want: the *Colour Picker* addin. Addins are tools that are available in Rstudio to facilitate tasks, lets try the colour picker (should be already in your addins toolbar).

![](img/1c_colPicker.gif)

**Exercise: ** Pick 4 colors you like and use them to create a boxplot of the distribution of number of treated by the trap type.

```{r include = F}
captures %>% 
  ggplot() +
  geom_boxplot(aes(y = treated, fill = factor(trap_type))) +
  scale_fill_manual(values = c('red4', 'blue3', 'skyblue', 'orchid'))
```


## Labels

Usually we try to avoid spaces when using names for the column names, but for our figure labels this could be not the most straight forward way to communicate our analysis, we can set specific labels to make our plots more readable and self explanatory. Let's improve bar plot figure a bit more to make it clearer, we can use the figure we previously created contained in our figures list `figures$bars`

```{r}
figures$bars <- figures$bars + # we call the figure previously created
  labs(# We will use the function labs to generate our labels
    title = 'Number of observations by Municipality', # The title we will give to our figure
    x = 'Number of observations', # The label for x axis
    y = 'Municipality', # label for y axis
    fill = 'Trap type'
  )

figures$bars
```


```{r Export objects, include=F}
# For now do it mannualy
save(captures, file = 'misc/II/captures.RData')
save(figures, file = 'misc/II/figures.RData')
save(tCaptures, file = 'misc/II/tCaptures.RData')
```

